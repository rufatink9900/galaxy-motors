{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% block content %}

<!-- HERO SECTION -->
<section class="relative overflow-hidden text-white">
    <div class="relative z-10 max-w-7xl mx-auto px-4 py-16 sm:py-20 lg:py-28">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 items-center">

            <!-- Text -->
            <div class="space-y-6">
                <h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold leading-snug text-center lg:text-left">
                    {% trans "Professional auto service with years of experience. Quality, trust, and speed are our priorities." %}
                </h1>
            </div>

            <!-- Image -->
            <div class="flex justify-center lg:justify-end">
                <img 
                    src="https://res.cloudinary.com/dzclcwqjg/image/upload/v1767019368/lyncandco900_xwbjgi.png"
                    alt="Electric Vehicle"
                    class="w-full max-w-sm sm:max-w-md lg:max-w-lg object-contain drop-shadow-xl"
                >
            </div>

        </div>
    </div>
</section>

<!-- 3D MODEL SECTION -->
<div class="relative flex justify-center lg:justify-end w-full">
    <div 
        id="car3d"
        class="w-full max-w-sm sm:max-w-md lg:max-w-lg h-[420px] rounded-2xl overflow-hidden">
    </div>

    <button
        id="toggle360"
        class="absolute bottom-4 right-4 bg-black/60 backdrop-blur-md border border-cyan-400/40 text-white px-4 py-2 rounded-full text-sm font-semibold hover:bg-cyan-500/20 transition">
        360° ON
    </button>
</div>

<!-- THREE.JS SCRIPT -->
<script type="module">
import * as THREE from 'https://unpkg.com/three@0.158.0/build/three.module.js';
import { GLTFLoader } from 'https://unpkg.com/three@0.158.0/examples/jsm/loaders/GLTFLoader.js';
import { OrbitControls } from 'https://unpkg.com/three@0.158.0/examples/jsm/controls/OrbitControls.js';

const container = document.getElementById('car3d');
const btn = document.getElementById('toggle360');

if (!container || !btn) {
    console.error('car3d or toggle360 NOT FOUND');
} else {
    let scene = new THREE.Scene();
    let camera = new THREE.PerspectiveCamera(
        45,
        container.clientWidth / container.clientHeight,
        0.1,
        100
    );
    camera.position.set(0, 1.6, 5);

    let renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    container.appendChild(renderer.domElement);

    // Lights
    scene.add(new THREE.AmbientLight(0xffffff, 1.5));
    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(5, 10, 5);
    scene.add(dirLight);

    // Controls
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.autoRotate = true;
    controls.autoRotateSpeed = 1.2;
    controls.enablePan = false;

    // Load GLB
    const loader = new GLTFLoader();
    loader.load("{% static 'models/lixiang_l9_2024.glb' %}",
        function (gltf) {
            gltf.scene.scale.set(1.1, 1.1, 1.1);
            gltf.scene.position.set(0, 0, 0);
            scene.add(gltf.scene);
            console.log('GLB loaded OK');
        },
        undefined,
        function (error) {
            console.error('Error loading GLB:', error);
        }
    );

    // 360 Button
    let autoRotate = true;
    btn.addEventListener('click', () => {
        autoRotate = !autoRotate;
        controls.autoRotate = autoRotate;
        btn.textContent = autoRotate ? '360° ON' : '360° OFF';
    });

    // Animate
    function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
    }
    animate();

    // Resize
    window.addEventListener('resize', () => {
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
    });
}
</script>

{% endblock %}
