{% extends "base.html" %}
{% load i18n %}
{% block content %}

<div class="container mx-auto px-4 py-6 sm:px-6 lg:px-8">

  <!-- Breadcrumb -->
  <nav class="mb-4">
    <ol class="flex items-center space-x-2 text-sm ">
      <li>
        <a href="{% url 'accessories' %}" class="hover:text-gray-700 transition-colors">Accessories</a>
      </li>
      <li class="flex items-center">
        <svg class="w-4 h-4 mx-1" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
        </svg>
      </li>
      <li>
        <span>{{ accessory.subcategory.category.name }}</span>
      </li>
      <li class="flex items-center">
        <svg class="w-4 h-4 mx-1" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
        </svg>
      </li>
      <li class="font-medium">
        {{ accessory.subcategory.name }}
      </li>
    </ol>
  </nav>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">

    <!-- LEFT: Gallery -->
    <div>
      <!-- Main Image Container -->
      <div class="relative bg-gray-50 rounded-2xl overflow-hidden shadow-sm h-80 md:h-96 lg:h-[420px] flex items-center justify-center mb-4">
        {% if accessory.main_image or accessory.additional_images.all %}
          <img id="mainImage" 
               src="{% if accessory.main_image %}{{ accessory.main_image.url }}{% endif %}" 
               alt="{{ accessory.name }}"
               class="w-full h-full object-contain bg-white">
          
          <!-- Navigation Arrows -->
          <div class="absolute inset-0 flex items-center justify-between p-4">
            <!-- Left Arrow -->
            <button id="prevBtn" 
                    class="prev-btn bg-black bg-opacity-50 hover:bg-opacity-70 text-white rounded-full w-10 h-10 flex items-center justify-center transition-all opacity-0 group-hover:opacity-100">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
            </button>
            
            <!-- Right Arrow -->
            <button id="nextBtn" 
                    class="next-btn bg-black bg-opacity-50 hover:bg-opacity-70 text-white rounded-full w-10 h-10 flex items-center justify-center transition-all opacity-0 group-hover:opacity-100">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </button>
          </div>
          
          <!-- Image Counter -->
          <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-50 text-white px-3 py-1 rounded-full text-sm">
            <span id="currentIndex">1</span> / <span id="totalImages">{{ accessory.additional_images.all|length|add:1 }}</span>
          </div>
        {% else %}
          <div class="text-gray-400">No image</div>
        {% endif %}
      </div>

      <!-- Thumbnails -->
      {% if accessory.main_image or accessory.additional_images.all %}
      <div class="flex space-x-3 overflow-x-auto pb-2 mb-4">
        {% if accessory.main_image %}
          <button onclick="goToImage(0)"
                  class="thumb-btn flex-shrink-0 w-16 h-16 md:w-20 md:h-20 rounded-xl overflow-hidden border-2 border-black transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black"
                  data-index="0">
            <img src="{{ accessory.main_image.url }}" 
                 alt="Main"
                 class="w-full h-full object-cover">
          </button>
        {% endif %}

        {% for img in accessory.additional_images.all %}
          <button onclick="goToImage({{ forloop.counter }})"
                  class="thumb-btn flex-shrink-0 w-16 h-16 md:w-20 md:h-20 rounded-xl overflow-hidden border-2 border-transparent hover:border-gray-300 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black"
                  data-index="{{ forloop.counter }}">
            <img src="{{ img.image.url }}" 
                 alt="Additional"
                 class="w-full h-full object-cover">
          </button>
        {% endfor %}
      </div>
      {% endif %}

    </div>

    <!-- RIGHT: Info -->
    <div>
      <!-- Category -->
      <div class="text-sm  mb-2">
        {{ accessory.subcategory.category.name }} • {{ accessory.subcategory.name }}
      </div>

      <!-- Title -->
      <h1 class="text-2xl md:text-3xl font-bold  mb-4">
        {{ accessory.name }}
      </h1>

      <!-- Price -->
      {% if accessory.price %}
        <div class="bg-black text-white text-lg md:text-xl font-bold rounded-xl px-5 py-3 inline-block mb-6">
          {{ accessory.price }} ₼
        </div>
      {% else %}
        <div class="text-gray-500 mb-6">{% trans "Price on request" %}</div>
      {% endif %}

      <!-- Description -->
      <div class="bg-gray-50 rounded-2xl p-5 md:p-6 mb-8">

        {% if accessory.description %}
          <p class="text-gray-700 leading-relaxed">{{ accessory.description }}</p>
        {% else %}
          <p class="text-gray-500 italic">No description available</p>
        {% endif %}
      </div>

      <!-- Action Buttons -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-6">
        <a href="tel:+994418400012" 
           class="inline-flex items-center justify-center px-6 py-3 border-2 border-gray-900  font-medium rounded-lg hover:bg-gray-50 hover:text-black focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900 transition-colors">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
          </svg>
          {% trans "Call us" %}
        </a>
        <a href="https://wa.me/994518400012" 
           target="_blank" 
           class="inline-flex items-center justify-center px-6 py-3 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-600 transition-colors">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.76.982.998-3.675-.236-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.9 6.994c-.004 5.45-4.438 9.88-9.888 9.88m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.333.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.333 11.893-11.893 0-3.18-1.24-6.162-3.495-8.411"/>
          </svg>
          WhatsApp
        </a>
      </div>
    </div>

  </div>

  <!-- Related accessories -->
  {% if related %}
    <div class="border-t border-gray-200 mt-12 pt-12">
      <h3 class="text-2xl font-bold  mb-6">Related accessories</h3>
      
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        {% for item in related %}
          <a href="{% url 'accessory_detail' item.id %}" 
             class="group block bg-white rounded-2xl shadow-sm hover:shadow-md transition-shadow overflow-hidden border border-gray-100">
            {% if item.main_image %}
              <div class="h-40 md:h-48 overflow-hidden">
                <img src="{{ item.main_image.url }}" 
                     alt="{{ item.name }}"
                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
              </div>
            {% endif %}
            <div class="p-4">
              <div class="text-xs text-gray-500 uppercase tracking-wide mb-1">
                {{ item.subcategory.name }}
              </div>
              <h4 class="font-semibold  group-hover:text-black transition-colors line-clamp-2">
                {{ item.name }}
              </h4>
              {% if item.price %}
                <div class="mt-3 font-bold text-lg ">
                  {{ item.price }} ₼
                </div>
              {% endif %}
            </div>
          </a>
        {% endfor %}
      </div>
    </div>
  {% endif %}

</div>

<script>
  // Collect all images
  const images = [
    {% if accessory.main_image %}
      "{{ accessory.main_image.url }}",
    {% endif %}
    {% for img in accessory.additional_images.all %}
      "{{ img.image.url }}",
    {% endfor %}
  ];

  let currentImageIndex = 0;
  const totalImages = images.length;

  // Initialize elements
  const mainImg = document.getElementById('mainImage');
  const currentIndexSpan = document.getElementById('currentIndex');
  const totalImagesSpan = document.getElementById('totalImages');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const galleryContainer = document.querySelector('.relative');

  // Show/hide arrows on hover
  if (galleryContainer) {
    galleryContainer.classList.add('group');
  }

  // Initialize counter
  if (totalImagesSpan) {
    totalImagesSpan.textContent = totalImages;
  }

  function updateMainImage(index) {
    if (index >= 0 && index < totalImages) {
      currentImageIndex = index;
      
      // Update main image
      if (mainImg) {
        mainImg.src = images[index];
      }
      
      // Update counter
      if (currentIndexSpan) {
        currentIndexSpan.textContent = index + 1;
      }
      
      // Update active thumbnail
      document.querySelectorAll('.thumb-btn').forEach(btn => {
        const btnIndex = parseInt(btn.getAttribute('data-index'));
        if (btnIndex === index) {
          btn.classList.remove('border-transparent', 'hover:border-gray-300');
          btn.classList.add('border-black');
        } else {
          btn.classList.remove('border-black');
          btn.classList.add('border-transparent', 'hover:border-gray-300');
        }
      });
    }
  }

  function goToImage(index) {
    updateMainImage(index);
  }

  function nextImage() {
    const nextIndex = (currentImageIndex + 1) % totalImages;
    updateMainImage(nextIndex);
  }

  function prevImage() {
    const prevIndex = (currentImageIndex - 1 + totalImages) % totalImages;
    updateMainImage(prevIndex);
  }

  // Event listeners for arrows
  if (prevBtn) {
    prevBtn.addEventListener('click', prevImage);
  }
  
  if (nextBtn) {
    nextBtn.addEventListener('click', nextImage);
  }

  // Keyboard navigation
  document.addEventListener('keydown', function(e) {
    if (totalImages <= 1) return;
    
    if (e.key === 'ArrowLeft') {
      prevImage();
    } else if (e.key === 'ArrowRight') {
      nextImage();
    }
  });

  // Initialize
  document.addEventListener('DOMContentLoaded', function() {
    if (totalImages > 0) {
      updateMainImage(0);
      
      // Show arrows if more than 1 image
      if (totalImages > 1) {
        if (prevBtn) prevBtn.style.opacity = '1';
        if (nextBtn) nextBtn.style.opacity = '1';
      }
    }
  });
</script>

{% endblock %}